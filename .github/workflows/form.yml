name: run open-test

on:
  workflow_dispatch:
    inputs:
      sprint:
        description: "è¿­ä»£åç§°"
        required: true
      baseURL:
        description: "å‰ç«¯éƒ¨ç½²ã€ŒåŸŸåã€"
        required: true
      teamname:
        description: "å›¢é˜Ÿåç§°"
        required: true
      ignore:
        description: "è¦å¿½ç•¥çš„é¡¹ç›®ã€Œones-projectã€ æˆ– ã€Œones-wikiã€"
        default: ""
        required: false
      username:
        description: "ç™»é™†è´¦å·ï¼ˆé»˜è®¤marsdev@ones.aiï¼‰"
        required: false
      password:
        description: "ç™»é™†å¯†ç ï¼ˆé»˜è®¤Test1234ï¼‰"
        required: false

jobs:
  open-test:
    runs-on: ubuntu-latest
    container: lironavon/docker-puppeteer-container:16.10.0
    env:
      PUPPETEER_SKIP_CHROMIUM_DOWNLOAD: true
      OPEN_ENV_CI: true
      PUPPETEER_EXECUTABLE_PATH: /usr/bin/google-chrome-stable
      CI: true

    steps:
      - name: Setup git in container
        uses: actions/checkout@v3

      - name: Setup pnpm
        uses: pnpm/action-setup@v2.2.4
        with:
          version: 7.3.0
          run_install: |
            - args: [--frozen-lockfile, --prod, --ignore-scripts]
      - name: ğŸš€ run open-test with sprint ${{ inputs.sprint }} on baseURL ${{ inputs.baseURL }}
        uses: ./
        with:
          sprint: ${{ inputs.sprint }}
          baseURL: ${{ inputs.baseURL }}
          ignore: ${{ inputs.ignore }}
          username: ${{ inputs.username }}
          password: ${{ inputs.password }}
          teamname: ${{ inputs.teamname }}

      - name: ğŸ“¦ Tar reporters
        if: failure()
        run: tar -cvf reporters.tar ./reporters

      - name: â« Upload slot reporters
        if: failure()
        uses: actions/upload-artifact@v3.1.0
        with:
          name: ${{ inputs.sprint }} - æ’æ§½æµ‹è¯•æŠ¥å‘Š
          path: reporters.tar